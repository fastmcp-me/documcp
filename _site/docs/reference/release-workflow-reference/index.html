<h1>Release Workflow Reference</h1>
<p>Technical reference for the DocuMCP release automation system.</p>
<h2>Release Script (<code>release.sh</code>)</h2>
<h3>Synopsis</h3>
<pre><code class="language-bash">./release.sh [VERSION_TYPE]
</code></pre>
<h3>Parameters</h3>
<ul>
<li><code>VERSION_TYPE</code>: <code>major</code>, <code>minor</code>, or <code>patch</code> (default: <code>patch</code>)</li>
</ul>
<h3>Exit Codes</h3>
<ul>
<li><code>0</code>: Success</li>
<li><code>1</code>: Error (invalid branch, dirty working directory, invalid version type, etc.)</li>
</ul>
<h3>Functions</h3>
<h4><code>print_status(message)</code></h4>
<p>Prints green status messages prefixed with <code>[RELEASE]</code>.</p>
<h4><code>print_warning(message)</code></h4>
<p>Prints yellow warning messages prefixed with <code>[WARNING]</code>.</p>
<h4><code>print_error(message)</code></h4>
<p>Prints red error messages prefixed with <code>[ERROR]</code>.</p>
<h3>Validation Checks</h3>
<ol>
<li><strong>Branch validation</strong>: Must be on <code>main</code> branch</li>
<li><strong>Working directory</strong>: Must be clean (no uncommitted changes)</li>
<li><strong>Version type</strong>: Must be <code>major</code>, <code>minor</code>, or <code>patch</code></li>
</ol>
<h3>Version Calculation</h3>
<p>Uses semantic versioning rules:</p>
<pre><code class="language-bash"># Current: 0.2.0
patch: 0.2.0 → 0.2.1
minor: 0.2.0 → 0.3.0  
major: 0.2.0 → 1.0.0
</code></pre>
<h2>GitHub Actions Workflow</h2>
<h3>Workflow File</h3>
<p><code>.github/workflows/release.yml</code></p>
<h3>Triggers</h3>
<h4>Tag-based Release</h4>
<pre><code class="language-yaml">on:
  push:
    tags:
      - 'v*.*.*'
</code></pre>
<h4>Manual Dispatch</h4>
<pre><code class="language-yaml">on:
  workflow_dispatch:
    inputs:
      version_type:
        description: 'Version bump type'
        required: true
        default: 'patch'
        type: choice
        options: [patch, minor, major]
</code></pre>
<h3>Jobs</h3>
<h4>Job: <code>test</code></h4>
<p><strong>Purpose</strong>: Pre-release validation<br>
<strong>Runner</strong>: <code>ubuntu-latest</code></p>
<p><strong>Steps</strong>:</p>
<ol>
<li>Checkout code (<code>actions/checkout@v4</code>)</li>
<li>Setup Node.js 20.x (<code>actions/setup-node@v4</code>)</li>
<li>Install dependencies (<code>npm ci</code>)</li>
<li>Run test suite with coverage (<code>npm test -- --coverage</code>)</li>
<li>Verify 80% coverage threshold</li>
<li>Run performance benchmarks (<code>npm run test:performance</code>)</li>
<li>Build verification (<code>npm run build</code>)</li>
</ol>
<p><strong>Coverage Validation</strong>:</p>
<pre><code class="language-bash">coverage=$(npm test -- --coverage --silent | grep &quot;All files&quot; | awk '{print $4}' | sed 's/%//')
if (( $(echo &quot;$coverage &lt; 80&quot; | bc -l) )); then
  echo &quot;Coverage $coverage% is below 80% threshold&quot;
  exit 1
fi
</code></pre>
<h4>Job: <code>release</code></h4>
<p><strong>Purpose</strong>: Create release and publish to npm<br>
<strong>Runner</strong>: <code>ubuntu-latest</code><br>
<strong>Depends on</strong>: <code>test</code></p>
<p><strong>Permissions</strong>:</p>
<pre><code class="language-yaml">permissions:
  contents: write
  packages: write
</code></pre>
<p><strong>Environment Variables</strong>:</p>
<ul>
<li><code>NODE_AUTH_TOKEN</code>: <code>$</code></li>
<li><code>GITHUB_TOKEN</code>: <code>$</code></li>
</ul>
<p><strong>Steps</strong>:</p>
<ol>
<li>Checkout with full history (<code>fetch-depth: 0</code>)</li>
<li>Setup Node.js with npm registry</li>
<li>Install dependencies and build</li>
<li>Generate changelog</li>
<li>Create GitHub release (tag-triggered only)</li>
<li>Publish to npm (tag-triggered only)</li>
</ol>
<p><strong>Release Body Template</strong>:</p>
<pre><code class="language-markdown">## DocuMCP Release $

### Features
- MCP Server for intelligent documentation deployment
- Repository analysis and SSG recommendations
- Automated GitHub Pages deployment workflows

### Coverage
- Test Coverage: 80%+ (requirement met)
- Performance: PERF-001 compliant
- Security: Automated dependency scanning

### Installation
npm install -g documcp@$
</code></pre>
<h4>Job: <code>docs</code></h4>
<p><strong>Purpose</strong>: Deploy documentation to GitHub Pages<br>
<strong>Runner</strong>: <code>ubuntu-latest</code><br>
<strong>Depends on</strong>: <code>test</code>, <code>release</code></p>
<p><strong>Permissions</strong>:</p>
<pre><code class="language-yaml">permissions:
  pages: write
  id-token: write
</code></pre>
<p><strong>Documentation Structure</strong>:</p>
<pre><code>docs-site/
├── index.md (from README.md)
├── docs/ (copied recursively)
└── coverage/ (test coverage reports)
</code></pre>
<h2>Secrets Configuration</h2>
<h3>Required Repository Secrets</h3>
<h4><code>NPM_TOKEN</code></h4>
<p><strong>Purpose</strong>: Authenticate npm package publishing<br>
<strong>Type</strong>: npm automation token<br>
<strong>Scope</strong>: Publish access to <code>documcp</code> package</p>
<p><strong>Setup</strong>:</p>
<ol>
<li>Generate token at https://www.npmjs.com/settings/tokens</li>
<li>Select &quot;Automation&quot; token type</li>
<li>Add to GitHub repository secrets</li>
</ol>
<h4><code>GITHUB_TOKEN</code></h4>
<p><strong>Purpose</strong>: Create GitHub releases<br>
<strong>Type</strong>: Automatic (provided by GitHub Actions)<br>
<strong>Scope</strong>: Repository contents and releases</p>
<h2>npm Package Configuration</h2>
<h3><code>package.json</code> Fields</h3>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;documcp&quot;,
  &quot;version&quot;: &quot;0.2.0&quot;,
  &quot;main&quot;: &quot;dist/index.js&quot;,
  &quot;type&quot;: &quot;module&quot;,
  &quot;engines&quot;: {
    &quot;node&quot;: &quot;&gt;=20.0.0&quot;
  }
}
</code></pre>
<h3>Build Configuration</h3>
<ul>
<li><strong>Source</strong>: <code>src/</code></li>
<li><strong>Output</strong>: <code>dist/</code></li>
<li><strong>Build command</strong>: <code>npm run build</code> (TypeScript compilation)</li>
<li><strong>Prepare hook</strong>: <code>npm run build</code> (runs before publish)</li>
</ul>
<h3>Publication Files</h3>
<p>Included in npm package:</p>
<ul>
<li><code>dist/</code> (compiled JavaScript)</li>
<li><code>package.json</code></li>
<li><code>README.md</code></li>
<li><code>LICENSE</code></li>
</ul>
<h2>Error Handling</h2>
<h3>Common Release Failures</h3>
<h4>Coverage Below 80%</h4>
<pre><code>Coverage 75% is below 80% threshold
</code></pre>
<p><strong>Solution</strong>: Increase test coverage before releasing</p>
<h4>npm Authentication Failed</h4>
<pre><code>npm ERR! code E401
npm ERR! 401 Unauthorized
</code></pre>
<p><strong>Solution</strong>: Verify <code>NPM_TOKEN</code> secret is configured correctly</p>
<h4>Tag Already Exists</h4>
<pre><code>fatal: tag 'v1.0.0' already exists
</code></pre>
<p><strong>Solution</strong>: Delete existing tag or increment version</p>
<h4>Build Failure</h4>
<pre><code>npm ERR! code 2
</code></pre>
<p><strong>Solution</strong>: Fix TypeScript compilation errors</p>
<h3>Rollback Procedures</h3>
<h4>Unpublish from npm (within 24 hours)</h4>
<pre><code class="language-bash">npm unpublish documcp@1.0.0
</code></pre>
<h4>Delete GitHub Release</h4>
<ol>
<li>Go to repository releases</li>
<li>Click &quot;Delete&quot; on the problematic release</li>
<li>Delete associated git tag:<pre><code class="language-bash">git tag -d v1.0.0
git push origin --delete v1.0.0
</code></pre>
</li>
</ol>
<h2>Performance Benchmarks</h2>
<p>The release workflow includes performance validation:</p>
<h3><code>npm run test:performance</code></h3>
<p>Executes benchmark tests ensuring:</p>
<ul>
<li>Memory usage within acceptable limits</li>
<li>Response time thresholds met</li>
<li>Throughput requirements satisfied</li>
</ul>
<h3>Benchmark Compliance</h3>
<p>Must meet PERF-001 compliance standards as defined in project benchmarks.</p>
