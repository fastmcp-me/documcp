<h1>How to Debug MCP Server Issues</h1>
<p>This guide helps you troubleshoot and debug common issues with the documcp MCP server and AI client integration.</p>
<h2>MCP Server Debugging Tools</h2>
<h3>Enable Debug Logging</h3>
<p>Start the MCP server with comprehensive debugging:</p>
<pre><code class="language-bash">DEBUG=documcp:* npm run dev
</code></pre>
<p>For specific components:</p>
<pre><code class="language-bash"># Tool execution debugging
DEBUG=documcp:tools npm run dev

# Repository analysis debugging  
DEBUG=documcp:analysis npm run dev

# MCP protocol debugging
DEBUG=mcp:* npm run dev
</code></pre>
<h3>MCP Server Inspector</h3>
<p>Run with Node.js inspector for breakpoint debugging:</p>
<pre><code class="language-bash">node --inspect dist/index.js
</code></pre>
<p>Connect via Chrome DevTools or VS Code debugger.</p>
<h3>Validate MCP Configuration</h3>
<p>Check your MCP server configuration:</p>
<pre><code class="language-bash"># Verify server starts correctly
npm run build &amp;&amp; node dist/index.js

# Test MCP protocol handshake
echo '{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;id&quot;: 1, &quot;method&quot;: &quot;initialize&quot;, &quot;params&quot;: {}}' | node dist/index.js
</code></pre>
<h2>Common MCP Integration Issues</h2>
<h3>Issue: AI Client Cannot Find MCP Server</h3>
<p><strong>Symptoms</strong>:</p>
<ul>
<li>&quot;MCP server not found&quot; errors</li>
<li>AI client shows no documcp tools available</li>
<li>Connection timeouts</li>
</ul>
<p><strong>Solutions</strong>:</p>
<ol>
<li>
<p><strong>Verify Installation Path</strong>:</p>
<pre><code class="language-bash">which node
npm list -g documcp
</code></pre>
</li>
<li>
<p><strong>Check AI Client Configuration</strong>:</p>
<pre><code class="language-json">// Claude Desktop: ~/Library/Application Support/Claude/claude_desktop_config.json
{
  &quot;mcpServers&quot;: {
    &quot;documcp&quot;: {
      &quot;command&quot;: &quot;node&quot;,
      &quot;args&quot;: [&quot;/correct/path/to/documcp/dist/index.js&quot;]
    }
  }
}
</code></pre>
</li>
<li>
<p><strong>Test Server Startup</strong>:</p>
<pre><code class="language-bash">node /path/to/documcp/dist/index.js
# Should show MCP server initialization logs
</code></pre>
</li>
</ol>
<h3>Issue: Tool Execution Failures</h3>
<p><strong>Symptoms</strong>:</p>
<ul>
<li>Tools appear available but fail when called</li>
<li>&quot;Validation error&quot; messages</li>
<li>Incomplete tool responses</li>
</ul>
<p><strong>Solutions</strong>:</p>
<ol>
<li>
<p><strong>Check File Permissions</strong>:</p>
<pre><code class="language-bash"># Ensure repository access
ls -la /path/to/target/repository
chmod -R 755 /path/to/target/repository
</code></pre>
</li>
<li>
<p><strong>Validate Input Parameters</strong>:</p>
<pre><code class="language-bash"># Test tool with minimal valid input
DEBUG=documcp:validation npm run dev
</code></pre>
</li>
<li>
<p><strong>Review Zod Schema Validation</strong>:</p>
<pre><code class="language-typescript">// Check tool parameter validation
import { z } from 'zod';

const schema = z.object({
  path: z.string().min(1),
  depth: z.enum(['quick', 'standard', 'deep']).optional()
});

// Validate your input
const result = schema.safeParse(yourInput);
if (!result.success) {
  console.error('Validation errors:', result.error.issues);
}
</code></pre>
</li>
</ol>
<h3>Issue: Repository Analysis Failures</h3>
<p><strong>Symptoms</strong>:</p>
<ul>
<li>&quot;Cannot analyze repository&quot; errors</li>
<li>Incomplete analysis results</li>
<li>Memory or timeout errors</li>
</ul>
<p><strong>Solutions</strong>:</p>
<ol>
<li>
<p><strong>Check Repository Structure</strong>:</p>
<pre><code class="language-bash"># Verify it's a valid repository
cd /path/to/repository
ls -la
git status  # If it's a git repo
</code></pre>
</li>
<li>
<p><strong>Increase Memory Limits</strong>:</p>
<pre><code class="language-bash">node --max-old-space-size=4096 dist/index.js
</code></pre>
</li>
<li>
<p><strong>Enable Analysis Debugging</strong>:</p>
<pre><code class="language-bash">DEBUG=documcp:analysis,documcp:filesystem npm run dev
</code></pre>
</li>
<li>
<p><strong>Test with Smaller Scope</strong>:</p>
<pre><code class="language-bash"># Analyze specific subdirectory first
DEBUG=documcp:* node -e &quot;
const { analyzeRepository } = require('./dist/tools/analyze-repository');
analyzeRepository({ path: './src', depth: 'quick' });
&quot;
</code></pre>
</li>
</ol>
<h2>MCP Protocol Debugging</h2>
<h3>Trace MCP Messages</h3>
<p>Monitor MCP protocol communication:</p>
<pre><code class="language-bash"># Enable MCP protocol tracing
DEBUG=mcp:protocol npm run dev
</code></pre>
<h3>Validate Tool Definitions</h3>
<p>Check that tools are properly registered:</p>
<pre><code class="language-bash"># List available tools
echo '{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;id&quot;: 1, &quot;method&quot;: &quot;tools/list&quot;}' | node dist/index.js
</code></pre>
<h3>Test Individual Tools</h3>
<p>Test tools in isolation:</p>
<pre><code class="language-bash"># Test analyze_repository tool
echo '{
  &quot;jsonrpc&quot;: &quot;2.0&quot;, 
  &quot;id&quot;: 1, 
  &quot;method&quot;: &quot;tools/call&quot;,
  &quot;params&quot;: {
    &quot;name&quot;: &quot;analyze_repository&quot;,
    &quot;arguments&quot;: {&quot;path&quot;: &quot;./test-repo&quot;, &quot;depth&quot;: &quot;quick&quot;}
  }
}' | node dist/index.js
</code></pre>
<h2>Performance Debugging</h2>
<h3>Memory Usage Analysis</h3>
<p>Monitor memory consumption during large repository analysis:</p>
<pre><code class="language-bash"># Enable garbage collection logs
node --expose-gc --trace-gc dist/index.js
</code></pre>
<h3>Profile Tool Execution</h3>
<p>Profile slow tool execution:</p>
<pre><code class="language-bash"># Generate CPU profile
node --prof dist/index.js
# Process profile after execution
node --prof-process isolate-*.log &gt; profile.txt
</code></pre>
<h3>Monitor File System Operations</h3>
<p>Track file system access patterns:</p>
<pre><code class="language-bash"># macOS
sudo fs_usage -w -f filesystem node dist/index.js

# Linux  
strace -e trace=file node dist/index.js
</code></pre>
<h2>TypeScript and Build Issues</h2>
<h3>Type Checking Errors</h3>
<p><strong>Symptoms</strong>: TypeScript compilation failures</p>
<p><strong>Solutions</strong>:</p>
<ol>
<li>
<p><strong>Run Type Checking</strong>:</p>
<pre><code class="language-bash">npm run typecheck
</code></pre>
</li>
<li>
<p><strong>Check tsconfig.json</strong>:</p>
<pre><code class="language-bash"># Verify TypeScript configuration
npx tsc --showConfig
</code></pre>
</li>
<li>
<p><strong>Update Type Definitions</strong>:</p>
<pre><code class="language-bash">npm install @types/node@latest
npm install @modelcontextprotocol/sdk@latest
</code></pre>
</li>
</ol>
<h3>Build Process Issues</h3>
<p><strong>Symptoms</strong>: Build failures, missing dist files</p>
<p><strong>Solutions</strong>:</p>
<ol>
<li>
<p><strong>Clean Build</strong>:</p>
<pre><code class="language-bash">rm -rf dist/
npm run build
</code></pre>
</li>
<li>
<p><strong>Check Build Dependencies</strong>:</p>
<pre><code class="language-bash">npm audit
npm install
</code></pre>
</li>
</ol>
<h3>npm ci Failures</h3>
<p><strong>Symptoms</strong>:</p>
<ul>
<li><code>npm ci</code> fails with &quot;Missing: package@version from lock file&quot;</li>
<li>Package-lock.json and package.json out of sync errors</li>
<li>CI/CD pipeline failures on dependency installation</li>
</ul>
<p><strong>Solutions</strong>:</p>
<ol>
<li>
<p><strong>Regenerate package-lock.json</strong>:</p>
<pre><code class="language-bash"># Remove existing lock file and node_modules
rm package-lock.json
rm -rf node_modules

# Reinstall dependencies
npm install

# Test that npm ci works
rm -rf node_modules
npm ci
</code></pre>
</li>
<li>
<p><strong>Fix package-lock.json sync issues</strong>:</p>
<pre><code class="language-bash"># Update lock file to match package.json
npm install --package-lock-only

# Verify the fix
npm ci
</code></pre>
</li>
<li>
<p><strong>Clear npm cache</strong> (if persistent issues):</p>
<pre><code class="language-bash">npm cache clean --force
npm install
</code></pre>
</li>
<li>
<p><strong>Ensure consistent Node.js/npm versions</strong>:</p>
<pre><code class="language-bash"># Check versions match .nvmrc
node --version  # Should be &gt;=20.0.0
npm --version

# Use exact Node.js version
nvm use $(cat .nvmrc)
npm ci
</code></pre>
</li>
</ol>
<h2>AI Client Specific Issues</h2>
<h3>Claude Desktop Integration</h3>
<p><strong>Debug Claude Desktop MCP Issues</strong>:</p>
<ol>
<li>
<p>Check Claude Desktop logs:</p>
<ul>
<li><strong>macOS</strong>: <code>~/Library/Logs/Claude/</code></li>
<li><strong>Windows</strong>: <code>%LOCALAPPDATA%\Claude\logs\</code></li>
</ul>
</li>
<li>
<p>Validate configuration syntax:</p>
<pre><code class="language-bash"># Validate JSON syntax
python -m json.tool ~/Library/Application\ Support/Claude/claude_desktop_config.json
</code></pre>
</li>
</ol>
<h3>GitHub Copilot Integration</h3>
<p><strong>Debug Copilot MCP Issues</strong>:</p>
<ol>
<li>Check VS Code extension logs</li>
<li>Verify MCP extension configuration</li>
<li>Test with minimal MCP server first</li>
</ol>
<h2>Getting Help</h2>
<h3>Diagnostic Information Collection</h3>
<p>When reporting issues, collect this information:</p>
<pre><code class="language-bash"># System information
node --version
npm --version
uname -a

# documcp information  
npm list documcp
DEBUG=documcp:* npm run dev 2&gt;&amp;1 | head -50

# MCP configuration
cat ~/.config/claude/claude_desktop_config.json  # or appropriate path
</code></pre>
<h3>Support Resources</h3>
<ol>
<li><strong>Check Documentation</strong>: <a href="../reference/api-reference.md">API Reference</a></li>
<li><strong>Search Issues</strong>: <a href="https://github.com/tosin2013/documcp/issues">GitHub Issues</a></li>
<li><strong>MCP Protocol</strong>: <a href="https://modelcontextprotocol.io/docs">MCP Specification</a></li>
<li><strong>Community Support</strong>: <a href="https://github.com/tosin2013/documcp/issues">Discussions</a></li>
</ol>
<h3>Creating Bug Reports</h3>
<p>Include in bug reports:</p>
<ul>
<li><strong>Environment</strong>: OS, Node.js version, AI client</li>
<li><strong>Configuration</strong>: MCP server config (sanitized)</li>
<li><strong>Reproduction Steps</strong>: Minimal example</li>
<li><strong>Logs</strong>: Debug output with sensitive data removed</li>
<li><strong>Expected vs Actual</strong>: Clear description of the issue</li>
</ul>
